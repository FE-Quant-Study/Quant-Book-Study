# 시장 데이터와 기본데이터: 소스와 기법

### 데이터는 항상 트레이딩의 중요 요소
우월한 정보에 접근 노력

고빈도 매매, 초고속망 구축

전통적 전략은 기술적 분석을 이용 주가와 거래량으로부터 계산된 지표를 통해 시장 데이터에서 신호를 추출


머신러닝 알고리즘은 인간이 정의한 규칙이나 경험보다 더 효율적인 시장 데이터와 기본 데이터를 활용

특히 대체 데이터와 결합할때 더욱 효율적으로 될 수 있음

트레이딩 환경의 세부 사항은 시장 데이터의 적절한 해석 뿐 아니라 전략의 설계와 실행 및 현실적인 백테스트 시뮬레이션 구현에 있어서도 중요함

### 다음과 같은 내용을 다룸
- 시장 데이터가 트레이딩 환경의 구조를 반영하는 방법
- 분 단위 빈도의 거래 데이터와 호가 데이터로 작업
- 나스닥 ITCH를 사용해 틱 데이터에서 주문 호가창을 재구성하는 방법
- 여러가지 형태의 바를 이용해 틱 데이터를 요약하는 방법
- XBRL로 인코딩된 전자 공시 자료들을 다루는 방법
- 시장 데이터와 기본 데이터를 구문 분석하고 결합해 주가 이익 배율 시계열을 만드는 방법
- 파이썬을 이용해 여러 시장 데이터와 기본 데이터 소 스에 접근하는 방법

### 시장 데이터는 시장 환경을 반영한다

시장 데이터는 금융 수단에 직접 또는 수많은 시장 중 하나의 시장에 있는 중개기관을 통해 주문을 내고 처리, 수요/ 공급 매칭에 이해 가격이 설정되는 방법의 산물임.
시장 데이터는 주문 매매, 가격 통제, 규제의 제도적 환경을 반영함.

알고리즘 트레이더는 ML을 포함한 알고리듬을 사용해 매수와 매도 주문의 흐름과 그 결과로 형성되는 거래량과 가격의 통계량을 분석해 트레이드 신호를 추출하며 이를 이용해 수요 공급 동태 또는 특정 시장 참여자의 형태에 대한 이해도를 높임

백테스트 동안 트레이딩 전략의 시뮬레이션에 영향을 주는 제도적 특성을 살펴보고 이러한 환경, 즉 나스닥에 의해 생성되는 실제 틱 데이터를 작업함

### 시장 미시 구조: 기본지식
시장 미시 구조는 제도적 환경이 트레이딩 과정에 어떻게 영향을 주고, 가격 발견, 매수-매도 호가 스프레드와 호가, 일중 트레이딩 행태와 거래 비용 같은 결과를 어떻게 형성하는지 연구함

### 트레이딩 장소: 거래소에서 다크풀까지

장외 시장
거래소
거래소 규제
베스트 마켓 또는 벤처 마켓과 같은 OTC 시장, 낮은 규제 장벽
채권이나 ADR
뉴욕증권거래소


### 틱에서 바로: 시장 데이터 정규화 방법
거래 데이터는 나노초에 의해 인덱스 되고 불규칙하게 도달하므로 매우 잡음이 많음.

매수 - 매도 호가 스프레드의 반동은 거래 개시가 매수와 매도 시장가 주문 사이에 교대로 일어나므로 가격이 매수와 매도 호가 사이에서 진동하게 만듬.
잡음-신호 비율과 통계적 특성을 개선하고자 거래 활동을 합계해 틱 데이터의 주기를 바꾸고 정규화한다

전형적으로 합계된 기간의 시가, 저가, 고가, 종가와 거래량과 함께 거래량 가중 평균 가격 거래량과 데이터와 관련된 타임스탬프를 수집한다.

### 가격 변화를 고려: 거래 금액 바
자산 가격이 크게 변하거나 주식 분할이 일어난 후 저잊ㄴ 주식수의 가치가 변한다.
거래량 바는 이런 사실을 정확하게 반영하지 못하고 이러한 변화가 일어난 기간 간의 트레이딩 행태를 제대로 비교하지 못하게 한다. 이 경우 거래량 바는 주식수와 가격의 곱을 이용한 거래 금액 바로 조정되야 한다.

### algoseek 분바: 주식 호가와 거래 데이터
기관 투자자에게만 제공됐던 품질의 과거 일별 데이터를 제공. 매우 상세한 일중 호가와 거래 데이터를 사용자 친화적 환경으로 제공
이는 일상적인 ML 기반 전략에서 쉽게 설계 및 백테스트를 할 수 있게 하기 위한 것.

### 시장 데이터에 대한 API 접근
판다스 라이브러리에 내장된 몇 가지 소스 및 종가 시장 데이터와 야후! 파이낸스로부터 최근 기본 데이터를 다운로딩 하기 쉽게 하는 yfinance 도 있음
퀀토피안, 퀀들, 집라인 백테스트 라이브러리.
깃허브의 data_providers 디렉터리는 옵션 사용 가능

판다스 라이브러리는 read_html 함수를 사용해 웹사이트 상의 데이터에 접근 할 수 있다. 
관련된 pandas-datareader 라이브러리를 통해 다양한 데이터 공급자의 API 단말에 접근할 수 있다


### 퀀토피안은 트레이딩 알고리즘을 대중으로부터 소싱하는 리서치  플랫폼을 제공하는 투자회사임
무료 등록으로 회원들은 광범위한 데이터 소스를 사용해 트레이딩 아이디어를 연구할 수 잇음. 알고리즘을 과거 데이터에 대해 백테스트 할 수 있을 뿐 아니라 실시간 데이터로 표본 외 데이터에 대해 포워드 테스트할 수 있는 환경도 제공함.
최상의 성과를 보인 알고리즘에는 자금을 투여하며 그 개발자에게 10% 이익 배분율을 수여함 (이 책의 저술시점에서는)

퀀토피안 리서치  플랫폼은 알파 팩터 리서치와 성과 분석을 위한 주피터 노트북 연구 개발 환경으로 구서오대 있음.
분 바 빈도의 과거 데이터를 이용해 알고리즘 전략을 코딩하고 결과를 백테스트하는 상호대화식 개발 환경도 제공

또한 사용자는 실시간 데이터로 알고리즘을 시뮬레이션할 수 있는데, 이는 페이퍼 트레이딩으로 아렬져 있음
1분 단위 빈도의 미국 주식과 선물 가격 및 거래량 데이터의 다양한 시장 데이터 세트 뿐 아니라 미국 기업의 기본적 및 수많은 대체 데이터를 제공함
-> 2020년 문을 닫음

집라인, 알파렌즈, 파이폴리오, 엠피리컬은 어느정도 기능을 유지하고 있음.

### 집라인
집라인은 퀀토피안 백테스트와 실시간 트레이딩 플랫폼을 작동시키는 알고리즘 트레이딩 라이브러리임.
오프라인에서도 사용할 수 있으므로 비록 제한된 수지만 무료 데이터 번들을 사용해 전략을 개발할 수 있으며 페이퍼 및 실시간 트레이딩을 위해 온라인 퀀토피안 플랫폼에 결과를 옮기기 전에 트레이딩 아이디어의 성과를 테스트하고자 사용할 수 있다.
집라인은 맞춤형 환경을 요구함.
노트북 zipline_data_demo.ipynb의 처음 부분에서 어떻게 집라인이 특정 범위 기업들의 일일 주식 데이터에 접근할 수 있는지 보여짐
그다음 handle_data를 호출하며 여기서 단일 기간을 돌아보는 data.history() 메서드를 사용해 마지막 날에 대한 데이터를 .csv파일에 첨부함

### 퀀들
퀀들은 파이썬 API를 사용해 광범위한 데이터 소스를 무료로 제공하며 구독 할 수도 있음. 등록하면 하루 50회이상 호출할 수 있는 무료 API 키를 얻을 수 있음. 퀀들 데이터는 주식 이상의 여러 자산군을 커버하는데 외환 채권 지수 선물 옵션과 상품을 포함함

### 알파밴티지:
실시간 주식, 암호화폐 시장 데이터와 기술적 지표들을 위한 파이썬 API를 제공

### 기본데이터 작업 방법
기본 데이터는 증권의 가치를 결정하는 경제적 동인과 관련이 있음
데이터의 성격은 자산군에 달려 있음
- 주식과 기업 크레딧의 경우 기본 데이터는 기업의 재뭄 및 산업과 경제 전반의 데이터를 포함함
- 정부채의 경우 기본 데이터는 국제 거시 경제 데이터와 외환을 포함함
- 상품의 경우 기본 데이터는 수확 시기의 날씨 데이터와 같은 자산 특화된 수급 결정 팩터들을 포함함

### 미국 주식 기본 데이터에 초점을 맞출 것
### 재무제포 데이터
미국 증권거래위원회는 미국 증권 발행 기업, 즉 뮤추얼  펀드를 포함한 상장 기업과 증권은 3개의 분기 재무제표와 1개의 연차보고서 , 규제를 위한 기타 여러 문서를 제출하게 함
에드가 시스템을 통해 이런 문서들을 공개함
기본적 분석을 위한 데이터 소스가 됨

### 자동 처리 : XBRL
규제 기관 제출 문서의 자동 분석이 훨씬 용이해짐
XML에 기반을 두고 있으며 보고서 요소의 의미를 정의하는 분류법에 의존하며 전자판 보고서의 해당 정보를 강조하는 태그에 매핑함
그중 한 분류는 US GAAP를 기술함

